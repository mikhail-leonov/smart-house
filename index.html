<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Home Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/mqtt@4.3.7/dist/mqtt.min.js"></script>
    <link href="../shared/ui.css" rel="stylesheet">
    <link href="../shared/home.css" rel="stylesheet">
    <script src="../shared/const.js"></script>
    <script src="../shared/log.js"></script>
    <script src="../shared/mqtt.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  </head>
  <body>
    <script>
      function showSection(sectionId) {
        // Hide all sections
        document.querySelectorAll('.section').forEach(section => {
          section.style.display = 'none';
        });
        // Show the selected section
        document.getElementById(sectionId).style.display = 'block';
      }
    </script>
    <div class="container container-no-left">
      <div class="sidebar">
        <h2>Smart Home</h2>
        <ul>
          <li onclick="showSection('map')">House Map</li>
          <li onclick="showSection('config')">Config</li>
        </ul>
      </div>
      <div class="main-content">
        <div class="dashboard-header">
          <h1>Smart Home Dashboard</h1>
          <div id="current-time"></div>
        </div>
        <!-- Config Section -->
        <div id="config" class="section" style="display: none;">
          <div class="card">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0">Config</h5>
              <button id="getConfigBtn" class="btn btn-sm btn-outline-secondary" onclick="generateConfig();">Get Config</button>
              <button id="copyConfigBtn" class="btn btn-sm btn-outline-secondary" onclick="selectTextAndCopy('config_text')">Copy</button>
            </div>
            <div class="card-body">
              <pre style="height: 600px" id="config_text">
{}
              </pre>
            </div>
          </div>
        </div>
        <!-- Map Section -->
        <div id="map" class="section" style="display: none;">
          <!-- Nav tabs Section -->
          <ul class="nav nav-tabs" id="myTab" role="tablist">
            <li class="nav-item" role="presentation">
              <button class="nav-link active" id="first-tab" data-bs-toggle="tab" data-bs-target="#first" type="button" role="tab" aria-controls="first" aria-selected="true"> First Floor </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="second-tab" data-bs-toggle="tab" data-bs-target="#second" type="button" role="tab" aria-controls="second" aria-selected="false"> Second Floor </button>
            </li>
            <li class="nav-item" role="presentation">
              <button class="nav-link" id="roof-tab" data-bs-toggle="tab" data-bs-target="#roof" type="button" role="tab" aria-controls="roof" aria-selected="false"> Roof </button>
            </li>
          </ul>
          <!-- Tab panes -->
          <div class="tab-content mt-3" id="myTabContent">
            <div class="tab-pane fade show active" id="first" role="tabpanel" aria-labelledby="first-tab">
              <!-- First Floor Tab -->
              <div class="floor-map">
                <h4></h4>
                <div class="floorplan">
                  <div class="room backyard" data-location="outside" data-floor="first_floor" data-room="backyard" onclick="entryClicked(this)">Backyard <div id="content">
                      <div id="soil_moisture" data-type="1" data-min="0" data-max="100"></div>
                      <div id="sprinkler_status" data-type="2"></div>
                    </div>
                  </div>
                  <div class="room pool" data-location="outside" data-floor="first_floor" data-room="pool" onclick="entryClicked(this)">Pool <div id="content">
                      <div id="water_temperature" data-type="1" data-min="0" data-max="40"></div>
                      <div id="vac_status" data-type="2"></div>
                    </div>
                  </div>
                  <div class="room home-left" data-location="outside" data-floor="first_floor" data-room="home-left" onclick="entryClicked(this)">Area left <div id="content">
                      <div id="soil_moisture" data-type="1" data-min="0" data-max="100"></div>
                      <div id="sprinkler_status" data-type="2"></div>
                    </div>
                  </div>
                  <div class="room pool-area" data-location="outside" data-floor="first_floor" data-room="pool-area" onclick="entryClicked(this)">Pool filter</div>
                  <div class="room ac-area" data-location="outside" data-floor="first_floor" data-room="ac-area" onclick="entryClicked(this)">AC</div>
                  <div class="room water-area" data-location="outside" data-floor="first_floor" data-room="water-area" onclick="entryClicked(this)">Water in</div>
                  <div class="room sprinkler-area" data-location="outside" data-floor="first_floor" data-room="sprinkler-area" onclick="entryClicked(this)">Sprinkler</div>
                  <div class="room office-1f" data-location="inside" data-floor="first_floor" data-room="office-1f" onclick="entryClicked(this)">Office <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="fan_speed" data-type="1" data-min="0" data-max="100"></div>
                    </div>
                  </div>
                  <div class="room bathroom-1f" data-location="inside" data-floor="first_floor" data-room="bathroom-1f" onclick="entryClicked(this)">Bathroom <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="water_leak" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room living-room-1f" data-location="inside" data-floor="first_floor" data-room="living-room-1f" onclick="entryClicked(this)">Living Room <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="fan_speed" data-type="1" data-min="0" data-max="100"></div>
                    </div>
                  </div>
                  <div class="room dining-area-1f" data-location="inside" data-floor="first_floor" data-room="dining-area-1f" onclick="entryClicked(this)">Dining Area <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="fan_speed" data-type="1" data-min="0" data-max="100"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room kitchen-1f" data-location="inside" data-floor="first_floor" data-room="kitchen-1f" onclick="entryClicked(this)">Kitchen <div id="content">
                      <div id="stove_status" data-type="2"></div>
                      <div id="microwave_status" data-type="2"></div>
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="fridge_temp" data-type="1" data-min="-10" data-max="10"></div>
                      <div id="water_leak" data-type="2"></div>
                      <div id="kettle_status" data-type="2" data-values="empty, heating, hot, warm, cold"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room corridor-1f" data-location="inside" data-floor="first_floor" data-room="corridor-1f" onclick="entryClicked(this)">Corridor <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room stairs-1f" data-location="inside" data-floor="first_floor" data-room="stairs-1f" onclick="entryClicked(this)">Stairs <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room laundry-1f" data-location="inside" data-floor="first_floor" data-room="laundry-1f" onclick="entryClicked(this)">Laundry <div id="content">
                      <div id="washer_status" data-type="2"></div>
                      <div id="dryer_status" data-type="2"></div>
                      <div id="water_leak" data-type="2"></div>
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room closet-1f" data-location="inside" data-floor="first_floor" data-room="closet-1f" onclick="entryClicked(this)">Closet <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room garage-1f" data-location="inside" data-floor="first_floor" data-room="garage-1f" onclick="entryClicked(this)">Garage <div id="content">
                      <div id="car_presence" data-type="2"></div>
                      <div id="door_status" data-type="2" data-values="open, opening, closed, closing"></div>
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="water_leak" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                    </div>
                  </div>
                  <div class="room hall-1f" data-location="inside" data-floor="first_floor" data-room="hall-1f" onclick="entryClicked(this)">Hall <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room front-yard" data-location="outside" data-floor="first_floor" data-room="frontyard" onclick="entryClicked(this)">Front Yard <div id="content">
                      <div id="soil_moisture" data-type="1" data-min="0" data-max="100"></div>
                      <div id="sprinkler_status" data-type="2"></div>
                    </div>
                  </div>
                  <div class="room driveway" data-location="outside" data-floor="first_floor" data-room="driveway" onclick="entryClicked(this)">Driveway <div id="content">
                      <div id="car_presence" data-type="2"></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="second" role="tabpanel" aria-labelledby="second-tab">
              <div class="floor-map">
                <h4></h4>
                <div class="floorplan">
                  <div class="room backend-area" data-location="outside" data-floor="first_floor" data-room="weather" onclick="entryClicked(this)">Area <div id="content">
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="relative_humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="dew_point" data-type="1" data-min="-20" data-max="35"></div>
                      <div id="precipitation" data-type="1" data-min="0" data-max="500"></div>
                      <div id="precipitation_probability" data-type="1" data-min="0" data-max="100"></div>
                      <div id="weather_code" data-type="2" data-values="0,1,2,3,45,48,51,53,55,56,57,61,63,65,66,67,71,73,75,77,80,81,82,85,86,95,96,99"></div>
                      <div id="pressure" data-type="1" data-min="500" data-max="1500"></div>
                      <div id="cloud_cover" data-type="1" data-min="0" data-max="100"></div>
                      <div id="visibility" data-type="1" data-min="0" data-max="100"></div>
                      <div id="wind_speed" data-type="1" data-min="0" data-max="500"></div>
                      <div id="wind_direction" data-type="2" data-values="N,NE,E,SE,S,SW,W,NW"></div>
                      <div id="wind_gusts" data-type="1" data-min="0" data-max="500"></div>
                      <div id="soil_temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="soil_moisture" data-type="1" data-min="0" data-max="100"></div>
                      <div id="pm10" data-type="1" data-min="0" data-max="500"></div>
                      <div id="pm2_5" data-type="1" data-min="0" data-max="500"></div>
                      <div id="carbon_monoxide" data-type="1" data-min="0" data-max="100"></div>
                      <div id="carbon_dioxide" data-type="1" data-min="0" data-max="5000"></div>
                      <div id="nitrogen_dioxide" data-type="1" data-min="0" data-max="500"></div>
                      <div id="sulphur_dioxide" data-type="1" data-min="0" data-max="500"></div>
                      <div id="ozone" data-type="1" data-min="0" data-max="500"></div>
                      <div id="aerosol_optical_depth" data-type="1" data-min="0" data-max="2"></div>
                      <div id="dust" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="uv_index" data-type="1" data-min="0" data-max="11"></div>
                      <div id="ammonia" data-type="1" data-min="0" data-max="500"></div>
                      <div id="methane" data-type="1" data-min="0" data-max="5000"></div>
                      <div id="alder_pollen" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="birch_pollen" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="grass_pollen" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="mugwort_pollen" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="olive_pollen" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="ragweed_pollen" data-type="1" data-min="0" data-max="1000"></div>
                      <div id="wave_height" data-type="1" data-min="0" data-max="20"></div>
                      <div id="wave_direction" data-type="1" data-min="0" data-max="360"></div>
                      <div id="wave_period" data-type="1" data-min="1" data-max="20"></div>
                      <div id="wind_wave_height" data-type="1" data-min="0" data-max="20"></div>
                      <div id="wind_wave_direction" data-type="2" data-values="N,NE,E,SE,S,SW,W,NW"></div>
                      <div id="wind_wave_period" data-type="1" data-min="1" data-max="20"></div>
                      <div id="swell_wave_direction" data-type="2" data-values="N,NE,E,SE,S,SW,W,NW"></div>
                      <div id="swell_wave_height" data-type="1" data-min="0" data-max="20"></div>
                      <div id="swell_wave_period" data-type="1" data-min="1" data-max="20"></div>
                      <div id="sea_level_height_msl" data-type="1" data-min="-10" data-max="10"></div>
                      <div id="sea_surface_temperature" data-type="1" data-min="-2" data-max="35"></div>
                      <div id="ocean_current_velocity" data-type="1" data-min="0" data-max="3"></div>
                      <div id="ocean_current_direction" data-type="2" data-values="N,NE,E,SE,S,SW,W,NW"></div>
                    </div>
                  </div>
                  <div class="room area-left" data-location="outside" data-floor="first_floor" data-room="weather" onclick="entryClicked(this)">Area</div>
                  <div class="room master-bedroom-2f" data-location="inside" data-floor="second_floor" data-room="master-bedroom-2f" onclick="entryClicked(this)">Master Bedroom <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room master-bathroom-2f" data-location="inside" data-floor="second_floor" data-room="master-bathroom-2f" onclick="entryClicked(this)">Master Bathroom <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="water_leak" data-type="2"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room master-closet-2f" data-location="inside" data-floor="second_floor" data-room="master-closet-2f" onclick="entryClicked(this)">Master Closet <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room stairs-2f" data-location="inside" data-floor="second_floor" data-room="stairs-2f" onclick="entryClicked(this)">Stairs <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room bathroom-2f" data-location="inside" data-floor="second_floor" data-room="bathroom-2f" onclick="entryClicked(this)">Bathroom 2F <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room hall-2f" data-location="inside" data-floor="second_floor" data-room="hall-2f" onclick="entryClicked(this)">Area <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room daria-bedroom-2f" data-location="inside" data-floor="second_floor" data-room="daria-bedroom-2f" onclick="entryClicked(this)">Daria Bedroom <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room ivan-bedroom-2f" data-location="inside" data-floor="second_floor" data-room="ivan-bedroom-2f" onclick="entryClicked(this)">Ivan Bedroom <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room den-2f" data-location="inside" data-floor="second_floor" data-room="den-2f" onclick="entryClicked(this)">Den <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                    </div>
                  </div>
                  <div class="room conditioner-2f" data-location="inside" data-floor="second_floor" data-room="conditioner-2f" onclick="entryClicked(this)">Cond <div id="content">
                      <div id="light_level" data-type="1" data-min="0" data-max="500"></div>
                      <div id="occupancy" data-type="2" data-values="0,1,2,3,4,5,6,7,8,9"></div>
                      <div id="temperature" data-type="1" data-min="-10" data-max="50"></div>
                      <div id="humidity" data-type="1" data-min="0" data-max="100"></div>
                      <div id="motion_detected" data-type="2"></div>
                      <div id="smoke_detected" data-type="2"></div>
                      <div id="window_status" data-type="2" data-values="open, closed, locked"></div>
                      <div id="shatter_status" data-type="2" data-values="open, closed, opening, closing"></div>
                      <div id="door_status" data-type="2" data-values="open, closed, locked"></div>
                    </div>
                  </div>
                  <div class="room frontyard-area" data-location="outside" data-floor="first_floor" data-room="weather" onclick="entryClicked(this)">Area</div>
                </div>
              </div>
            </div>
            <div class="tab-pane fade" id="roof" role="tabpanel" aria-labelledby="roof-tab">
              <div class="floor-map">
                <h4></h4>
                <div class="floorplan">
                  <div class="room backend-area" data-location="outside" data-floor="first_floor" data-room="weather" onclick="entryClicked(this)">Area </div>
                  <div class="room area-left" data-location="outside" data-floor="first_floor" data-room="weather" onclick="entryClicked(this)">Area </div>
                  <div class="room roof" data-location="outside" data-floor="first_floor" data-room="roof" onclick="entryClicked(this)">Roof </div>
                  <div class="room frontyard-area" data-location="outside" data-floor="first_floor" data-room="weather" onclick="entryClicked(this)">Area </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="dataModal" tabindex="-1" aria-labelledby="dataModalLabel" aria-hidden="true" style="width:500px">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="dataModalLabel">Room Data</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <pre id="modalContent"></pre>
              </div>
            </div>
          </div>
        </div>

        <script>
          let homeStatus = {};
          const basePath = "home/#";
          // Clean up on page unload
          window.addEventListener('beforeunload', () => {
            if (mqttClient && mqttClient.connected) {
              mqttClient.end();
            }
          });
          const connected = connectToMqtt();
          mqttClient.on('connect', () => {
            mqttClient.subscribe(basePath, (err) => {});
          });


          // Update current time
          function updateTime() {
            const now = new Date();
            const options = {
              weekday: 'long',
              year: 'numeric',
              month: 'long',
              day: 'numeric',
              hour: '2-digit',
              minute: '2-digit',
              second: '2-digit'
            };
            document.getElementById('current-time').textContent = now.toLocaleDateString('en-US', options);
          }
          // LOG
          //setTimeout(() => { fetch(LOG_URL, { method: 'POST', headers: { 'Content-Type': 'application/json', }, body: JSON.stringify({ msg: `UI App started` }), }); }, 0);
          // Update time every second
          updateTime();
          setInterval(updateTime, 1000);
          // Show house summary by default
          showSection('map');


          function generateConfigSection(location, floor) {
            let elements = document.querySelectorAll(`div[data-location="${location}"][data-floor="${floor}"]`);
            let section = {};
            elements.forEach(el => {
              sectionName = el.getAttribute('data-room');
              if (!section[sectionName]) {
                section[sectionName] = {};
              }
              let sensors = generateSectionVariables(el);
              Object.assign(section[sectionName], sensors);
            });
            return section;
          }

          function generateConfig() {
            let config = {};
            config.home = {};
            config.home.inside = {};
            config.home.inside.house = {};
            config.home.inside.first_floor = generateConfigSection("inside", "first_floor");
            config.home.inside.second_floor = generateConfigSection("inside", "second_floor");
            config.home.outside = {};
            config.home.outside.first_floor = generateConfigSection("outside", "first_floor");
            const configText = document.getElementById('config_text');
            configText.innerText = formatJSON(config);
          }

          function formatJSON(obj, indentLevel = 0) {
            const indent = '  '.repeat(indentLevel);

            function isLeafObject(o) {
              return typeof o === 'object' && o !== null && !Array.isArray(o) && Object.values(o).every(val => typeof val !== 'object' || val === null || Array.isArray(val));
            }
            if (Array.isArray(obj)) {
              const items = obj.map(item => formatJSON(item, indentLevel + 1));
              return `[\n${items.map(i => indent + '  ' + i).join(',\n')}\n${indent}]`;
            } else if (typeof obj === 'object' && obj !== null) {
              if (isLeafObject(obj)) {
                const inline = Object.entries(obj).map(
                  ([k, v]) => `"${k}": ${JSON.stringify(v)}`).join(', ');
                return `{ ${inline} }`;
              } else {
                const entries = Object.entries(obj).map(
                  ([k, v]) => `${indent}  "${k}": ${formatJSON(v, indentLevel + 1)}`);
                return `{\n${entries.join(',\n')}\n${indent}}`;
              }
            } else {
              return JSON.stringify(obj);
            }
          }

          function generateSectionVariables(element) {
            let result = {};
            let contentNodes = element.querySelectorAll('div#content');
            if (contentNodes) {
              contentNodes.forEach(div => {
                Array.from(div.children).forEach(child => {
                  if (child.id) {
                    result[child.id] = getSettingsObject(child);
                  }
                });
              });
            }
            return result;
          }

          function convertStringsToNumbers(arr) {
            return arr.map(item => {
              if (typeof item === 'string') {
                // Try to convert string to number
                const num = Number(item);
                // Check if conversion is successful and not NaN
                if (!isNaN(num)) {
                  return num;
                }
              }
              // Otherwise return original item
              return item;
            });
          }

          function getSettingsObject(el) {
            let result = {
              value: "",
              description: "",
              min_value: "",
              max_value: ""
            };
            childType = el.getAttribute('data-type');
            if (childType) {
              if (childType === "1") {
                let min = el.getAttribute('data-min');
                let max = el.getAttribute('data-max');
                if (min) {
                  if (max) {
                    min = Number(min);
                    max = Number(max);
                    let value = Math.round(Math.random() * (max - min) + min);
                    let descr = "";
                    if (el.getAttribute('data-descr')) {
                      descr = el.getAttribute('data-descr');
                    }
                    result = {
                      value: value,
                      description: descr,
                      min_value: min,
                      max_value: max
                    };
                  }
                }
              }
              if (childType === "2") {
                let values = el.getAttribute('data-values');
                if (!values) {
                  values = [0, 1];
                } else {
                  values = values.split(",").map(s => s.trim());
                  values = convertStringsToNumbers(values);
                }
                let value = values[Math.floor(Math.random() * values.length)];
                let descr = "";
                if (el.getAttribute('data-descr')) {
                  descr = el.getAttribute('data-descr');
                }
                result = {
                  value: value,
                  description: descr,
                  values: values
                };
              }
            }
            return result;
          }

          function selectTextAndCopy(elementId) {
            const element = document.getElementById(elementId);
            if (!element) return;
            const range = document.createRange();
            range.selectNodeContents(element);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
              document.execCommand('copy');
              alert('Copied to clipboard!');
            } catch (err) {
              alert('Failed to copy text.');
            }
            selection.removeAllRanges();
          }


          mqttClient.on('message', (topic, message) => {

            const payload = message.toString();
            const pathParts = topic.split('/');

            // Extract parts for locating the room and sensor:
            // Assuming topic format: "home/inside/first_floor/living-room-1f/temperature" or similar
            const [home, location, floor, room, sensor] = pathParts;

            // Find the matching room div by data attributes
            const roomDiv = document.querySelector( `.room[data-location="${location}"][data-floor="${floor}"][data-room="${room}"]`);

            if (roomDiv) {
              // Inside roomDiv find the sensor div by id
              const sensorDiv = roomDiv.querySelector(`#${sensor}`);
              if (sensorDiv) {
                  // Update the textContent or value attribute (depending on your UI needs)
                  //sensorDiv.textContent = payload;
      
                 // Optional: If you want to store as an attribute for further logic
                 sensorDiv.setAttribute('data-value', payload );
            }
          }
          });

          function entryClicked(roomDiv) {
            // Build table rows with id, and value (textContent)
            let tableRows = '';

            const contentDiv = roomDiv.querySelector('#content');
            if (!contentDiv) {
              tableRows = 'No content found!';
              return;
            }
            // Gather all immediate child divs inside content
            const nestedDivs = contentDiv.querySelectorAll('div[id]');
            nestedDivs.forEach(div => {
              const id = div.id;
              let payload = {value: "",type: "",timestamp: ""};
              const value = div.getAttribute('data-value');
              if (value) { payload = JSON.parse(value); }

              let valueText = payload.value;

              if (payload.type.toLowerCase() == "random") {
                  valueText = "<b style='color: #d3d3d3;'>" + valueText + "</b>";
              }
              if (payload.type.toLowerCase() == "web") {
                  valueText = "<b class='text-success'>" + valueText + "</b>";
              }
              if (payload.type.toLowerCase() == "sensor") {
                  valueText = "<b class='text-primary'>" + valueText + "</b>";
              }

              tableRows += `<tr><td>${id}</td><td>${valueText}</td></tr>`;
            });
            // Create full table HTML
            const tableHTML = `<table style='width:100%'><tbody>${tableRows}</tbody></table>`;
            // Show it in modal or some container; here let's use alert for simplicity
            // But better: inject into some modal or div with id 'modalContent'

            const modalContent = document.getElementById('modalContent');
            if (modalContent) {
              modalContent.innerHTML = tableHTML;
              const modal = new bootstrap.Modal(document.getElementById('dataModal'));
              modal.show();
            }
          }

        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>